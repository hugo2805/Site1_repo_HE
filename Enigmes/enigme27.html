<link rel="stylesheet" type="text/css" href="../css/default.css">


<body id="content">
    <div class="parchemin">
        <p>
            Pouvez-vous diviser ce carré en 4 parties de forme identique englobant chacune une montre à gousset et de la poussière de temps pour la faire fonctionner ?
        </p>
    </div>
    
    <div id="matrix">
        
    </div>

</body>

<style>
    .slot{
        display: flex;
        justify-content: center;
        align-items: center;

        width: 15vw;
        height: 15vw;

        border: solid 1px black;
        cursor: pointer;
    }

    #matrix div{
        display: flex;
        flex-direction: row;
    }

    img{
        width: 80%;
        height: 80%;
        pointer-events: none;

        -webkit-touch-callout: none; /* iOS Safari */
        -webkit-user-select: none; /* Safari */
        -khtml-user-select: none; /* Konqueror HTML */
        -moz-user-select: none; /* Old versions of Firefox */
        -ms-user-select: none; /* Internet Explorer/Edge */
        user-select: none;
    }
</style>

<script>
    var colors = ['yellow', 'orange', 'red', 'violet'];
    var matrix = [
        [0,0,0,1,1,1],
        [0,0,0,1,1,1],
        [0,0,0,1,1,1],
        [2,2,2,3,3,3],
        [2,2,2,3,3,3],
        [2,2,2,3,3,3]
    ];

    var winMatrix = [
        [0,1,1,1,1,1],
        [0,1,0,1,3,3],
        [0,0,0,1,1,3],
        [0,2,2,3,3,3],
        [0,0,2,3,2,3],
        [2,2,2,2,2,3]
    ];

    var matrixParent = document.getElementById("matrix");

    for (var i = 0; i < 6; i++){
        var newRow = document.createElement("div");
        newRow.setAttribute("class", "row");
        for (var j = 0; j < 6; j++){
            var newSlot = document.createElement("div");
            newSlot.setAttribute("class", "slot");
            if (!(i==2&&j==2 || i==2&&j==3 || i==3&&j==2 || i==3&&j==3))
                newSlot.setAttribute("onclick", "NextColor("+i+","+j+")");
            newRow.appendChild(newSlot);
        }
        matrixParent.appendChild(newRow);
    }

    UpdateColors();
    SetGoals();

    function SetGoals(){
        var rows = document.getElementsByClassName("row");
        for (var i = 0; i < 6; i++){
            var rowChilds = rows[i].childNodes;
            for (var j = 0; j < 6; j++){
                if (i==2&&j==2 || i==2&&j==3 || i==3&&j==2 || i==3&&j==3){
                    var newGoal = document.createElement("img");
                    newGoal.setAttribute("src", "../Images/magic-dust.png");
                    rowChilds[j].appendChild(newGoal);
                }
                if (i==0&&j==5 || i==4&&j==1 || i==4&&j==2 || i==4&&j==3){
                    var newGoal = document.createElement("img");
                    newGoal.setAttribute("src", "../Images/clock.png");
                    rowChilds[j].appendChild(newGoal);
                }
            }
        }
    }

    function UpdateColors(){
        var rows = document.getElementsByClassName("row");
        for (var i = 0; i < 6; i++){
            var rowChilds = rows[i].childNodes;
            for (var j = 0; j < 6; j++){
                rowChilds[j].style.backgroundColor = colors[matrix[i][j]];
            }
        }
    }

    function NextColor(ord, abs){
        if (matrix[ord][abs] == 3)
            matrix[ord][abs] = 0;
        else
            matrix[ord][abs]++;
        UpdateColors();
        CheckVictory();
    }

    function CheckVictory(){
        var isVictory = true;
        for (var i = 0; i < 6; i++)
            for (var j = 0; j < 6; j++)
                if (matrix[i][j] != winMatrix[i][j])
                    isVictory = false;
        if (isVictory)
            window.location.href = "uniwebview://feedback?anwser=" + 1;
    }
</script>